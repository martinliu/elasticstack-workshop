---
title: "Elasticsearch 核心概念梳理"
date: 2022-09-18T12:41:32+08:00
lastmod: 2022-09-18T17:41:32+08:00
publishdate: 2022-09-18T20:41:32+08:00
description: "在开发和运维工作中必要掌握的技术"
---

## 准备工作

准备三个 Linux 虚拟机，将 Elasticsearch 8 安装包上传到这些虚拟机的非 root 用户的 home 目录中。将 Kibana 8 的安装包上传到其中一个虚拟机上。

参考这篇教程 [在 Linux 上运行 Elasticsearch 8.1.0](https://elastic.martinliu.cn/chapter3/chapter3-1/3/) 。


## 核心概念

![core concepts](/images/core-cencepts.jpg)



## 索引管理



### 索引的创建、删除和查看

```
PUT blog

DELETE blog

PUT Blog

PUT blog

GET blog
```

### 索引属性的查看和更新

```
GET blog/_settings

PUT blog/_settings
{
  "number_of_replicas": 2
}

GET blog/_settings

PUT blog/_settings
{
  "number_of_shards": 2
}

GET blog/_settings
```

创建带有目标属性的索引
```
DELETE blog

PUT blog
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 2
  }
}

GET blog
```

### 在索引中索引文档

```
POST blog/_doc/1
{
  "title": "Java虚拟机"
}

GET blog/_doc/1

PUT blog/_settings
{
  "blocks.write": true
}

GET blog/_settings

GET blog/_doc/1

POST blog/_doc/2
{
  "title": "AWS EC2 虚拟机"
}

PUT blog/_settings
{
  "blocks.write": false
}

POST blog/_doc/2
{
  "title": "AWS EC2 虚拟机"
}

GET blog/_doc/2

POST blog/_search
```

### 索引的打开和关闭

```
POST blog/_search

POST blog/_doc/3
{
  "title": "Azure 虚拟机"
}

POST blog/_search

POST blog/_close

POST blog/_search

POST blog/_doc/4
{
  "title": "GCP 虚拟机"
}

POST blog/_open

POST blog/_doc/4
{
  "title": "GCP 虚拟机"
}

POST blog/_search
```

### 索引的复制

```
POST blog/_search

POST _reindex
{
  "source": {"index": "blog"},
  "dest": {"index": "blog_old_readonly"}
}

GET blog_old_readonly

GET blog_old_readonly/_search

DELETE blog_old_readonly

PUT blog_old_readonly
{
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0
  }
}

GET blog_old_readonly

POST _reindex
{
  "source": {"index": "blog"},
  "dest": {"index": "blog_old_readonly"}
}

POST blog_old_readonly/_search
```

### 使用别名访问索引

```
GET blog/_settings

GET blog/_search

GET blog_old_readonly/_search

DELETE blog

PUT blog_new
{
  "settings": {
    "number_of_shards": 2,
    "number_of_replicas": 1
  }
}

GET blog_new

POST blog_new/_search

POST blog_new/_doc/5
{
  "title": "聊一聊云主机性价比哪家强"
}

POST blog_new/_search

POST blog_new/_doc/6
{
  "title": " 为什么要使用对象存储？"
}

POST blog_new/_search
{
  "explain": true
}

GET blog_new/

POST /_aliases
{
  "actions": [
    {
      "add": {
        "index": "blog_new",
        "alias": "blog_all"
      }
    }
  ]
}

GET blog_all/_search

POST /_aliases
{
  "actions": [
    {
      "add": {
        "index": "blog_old_readonly",
        "alias": "blog_all"
      }
    }
  ]
}

GET blog_all/_search

GET blog_new/

GET blog_old_readonly

GET blog_all/_alias

GET blog_all/_search

GET _cat/nodes

GET _cat/shards

POST blog_new/_search
{
  "explain": true
}

POST blog_new/_search
{
  "explain": true,
  "query": {
    "match_all": {}
  }
}

```

### 在索引中管理文档记录

PUT blog_now
{
  "mappings": {
    "dynamic": "strict",
    "properties": {
      "title": {"type": "text"},
      "content": {"type": "text"},
      "posttime": {"type": "date"}
  },
  "settings": {
    "number_of_shards": 2,
    "number_of_replicas": 1
  }
}


PUT movies
{
  "mappings": {
    "properties": {
      "movieid": {"type": "integer"},
      "title": {"type": "text"},
      "genres": {"type": "text"},
      "search_index": {"type": "text"}
  },
  "settings": {
    "number_of_shards": 1,
    "number_of_replicas": 0
  }
}

 curl -X DELETE  "https://zheng.liu:nhB.sK3H7-vJGdeK@3c868db6258a424f9957e4a074593e9b.europe-west3.gcp.cloud.es.io:9243/martin-stats?pretty"

curl -XPUT "https://zheng.liu:nhB.sK3H7-vJGdeK@3c868db6258a424f9957e4a074593e9b.europe-west3.gcp.cloud.es.io:9243/martin-stats?pretty" -H "Content-Type: application/json" -d'
{
  "mappings": {
    "properties": {
      "weeks": { "type": "integer"},
      "workshop":{
        "properties": {
          "pv": {
            "type": "integer"
          },
          "uv": {
            "type": "integer"
          }
        }
      },
      "bilibili": {
        "properties": {
          "follower": {
            "type": "integer"
          },
          "arc_passed_total": {
            "type": "integer"
          },
          "inc_click": {
            "type": "integer"
          },
          "inc_dm":{
            "type": "integer"
          },
          "icn_reply": {
            "type": "integer"
          },
          "inc_fav": {
            "type": "integer"
          },
          "inc_coin": {
            "type": "integer"
          },
          "inc_share":{
            "type": "integer"
          },
          "inc_like": {
            "type": "integer"
          },
          "inc_elec": {
            "type": "integer"
          }
        }
      }
    }
  }
}'